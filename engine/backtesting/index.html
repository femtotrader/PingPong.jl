<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a backtest · PingPong.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PingPong.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">-</a></li><li><a class="tocitem" href="../../types/">Types</a></li><li><a class="tocitem" href="../../strategy/">Strategy interface</a></li><li><a class="tocitem" href="../engine/">Engine</a></li><li><a class="tocitem" href="../../exchanges/">Exchanges</a></li><li><a class="tocitem" href="../../data/">Data</a></li><li><a class="tocitem" href="../../processing/">Processing</a></li><li><span class="tocitem">Watchers</span><ul><li><a class="tocitem" href="../../watchers/watchers/">Watchers</a></li><li><a class="tocitem" href="../../watchers/apis/coingecko/">CoinGecko</a></li><li><a class="tocitem" href="../../watchers/apis/coinpaprika/">CoinPaprika</a></li><li><a class="tocitem" href="../../watchers/apis/coinmarketcap/">CoinMarketCap</a></li></ul></li><li><a class="tocitem" href="../../misc/">Misc</a></li><li><a class="tocitem" href="../../plotting/">Plotting</a></li><li><a class="tocitem" href="../../analysis/">Analysis</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Running a backtest</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a backtest</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/untoreh/PingPong.jl/blob/master/docs/src/engine/backtesting.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-a-backtest"><a class="docs-heading-anchor" href="#Running-a-backtest">Running a backtest</a><a id="Running-a-backtest-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-backtest" title="Permalink"></a></h1><p>To run a backtest you construct a strategy and then call <code>backtest!</code> on it.</p><ul><li>The strategy loads by default a config in user/config.toml</li><li>The config defines the strategy file under <code>include_file</code> key in the <code>[Example]</code> section</li><li>The strategy file <code>Example.jl</code> defines the <code>Example</code> module</li></ul><pre><code class="language-julia hljs">using Engine.Strategies
using Engine.Executors: Backtest as bt
s = strategy(:Example)
# Load data in the strategy universe (you need to already have it)
fill!(s) # or stub!(s.universe, datadict)
# backtest the strategy within the period available from the loaded data.
bt.backtest!(s)
# Lets see how we fared:
display(s)
## output
Name: Example
Config: 10.0(USDT)(Base Size), 100.0(USDT)(Initial Cash)
Universe: 3 instances, 1 exchanges
Holdings: assets(trades): 2(977), min BTC: 23.13(USDT), max XMR: 79.611(USDT)
Pending buys: 3
Pending sells: 0
USDT: 32.593 (Cash)
USDT: 156.455 (Total)</code></pre><p>Our backtest says that our strategy...</p><ul><li>Operated on 3 assets (instances)</li><li>Executed 977 trades</li><li>Starting from 100 USDT it finished with 32 USDT in cash, and 156 USDT worth of assets</li><li>The assets at the end with the minimum value was btc and the one with the maximum value was xmr.</li><li>At the end there were 3 left open buy orders and no open sell orders.</li></ul><h1 id="Limit-Orders"><a class="docs-heading-anchor" href="#Limit-Orders">Limit Orders</a><a id="Limit-Orders-1"></a><a class="docs-heading-anchor-permalink" href="#Limit-Orders" title="Permalink"></a></h1><p>To make a limit order within your strategy you call <code>pong!</code> just like any call to the executor. The arguments:</p><pre><code class="language-julia hljs">trade = pong!(s, LimitOrder{Buy}, ai; price, amount, date=ts)</code></pre><p>Where <code>s</code> is your <code>Strategy</code> instance, <code>ai</code> is the <code>AssetInstance</code> which the order refers to (it should be one present in your <code>s.universe</code>) amount is the quantity in base currency and date should be the one fed to the <code>ping!</code> function, which during backtesting would be the current timestamp being evaluated, and during now a recent timestamp. If you look at the example strategy <code>ts</code> is <em>current</em> and <code>ats</code> <em>available</em>. The available timestamp <code>ats</code> is the one that matches the last candle that doesn&#39;t give you forward knowledge. The <code>date</code> given to the order call (<code>pong!</code>) must be always the <em>current</em> timestamp.</p><p>A limit order call might return a trade if the order was queued correctly. If the trade hasn&#39;t completed the order, the order is queued in <code>s.orders[ai]</code>. If <code>isnothing(trade)</code> is <code>true</code>it means the order failed, and was not scheduled, this can happen if the cost of the trade did not meet the asset limits, or there wasn&#39;t enough commitable cash. If instead <code>ismissing(trade)</code> is <code>true</code> it means that the order was scheduled, but that no trade has yet been performed. In backtesting this happen if the price of the order is too low(buy) or too high(sell) for the current candle high/low prices.</p><p>At each iteration we need to check if pending orders are fullfilled, therefore we call:</p><pre><code class="language-julia hljs">pong!(s, ts, UpdateOrders())</code></pre><p>Remember that we always give the <em>current</em> time. Also if you look at the example strategy, the call is executed right at the beginning of the <code>ping!</code> function. <code>UpdateOrder</code> should always be called exactly at the beginning and not anywhere else, otherwise during backtesting an order would be executed twice on the same timestamp. This might be made implicit in future version.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 27 March 2023 14:59">Monday 27 March 2023</span>. Using Julia version 1.9.0-rc1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
