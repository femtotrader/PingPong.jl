<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Optimization · PingPong.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="PingPong.jl logo"/></a><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../">What is PingPong?</a></li></ul></li><li><a class="tocitem" href="../types/">Types</a></li><li><a class="tocitem" href="../strategy/">Strategies</a></li><li><span class="tocitem">Engine</span><ul><li><a class="tocitem" href="../engine/engine/">Executors</a></li><li><a class="tocitem" href="../engine/backtesting/">Backtesting</a></li><li><a class="tocitem" href="../engine/paper/">Paper</a></li></ul></li><li><a class="tocitem" href="../exchanges/">Exchanges</a></li><li><a class="tocitem" href="../data/">Data</a></li><li><span class="tocitem">Watchers</span><ul><li><a class="tocitem" href="../watchers/watchers/">Interface</a></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Apis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../watchers/apis/coingecko/">CoinGecko</a></li><li><a class="tocitem" href="../watchers/apis/coinpaprika/">CoinPaprika</a></li><li><a class="tocitem" href="../watchers/apis/coinmarketcap/">CoinMarketCap</a></li></ul></li></ul></li><li><a class="tocitem" href="../stats/">Stats</a></li><li class="is-active"><a class="tocitem" href>Optimization</a><ul class="internal"><li><a class="tocitem" href="#Multi-threading"><span>Multi threading</span></a></li><li><a class="tocitem" href="#Plotting-results"><span>Plotting results</span></a></li></ul></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><span class="tocitem">Misc</span><ul><li><a class="tocitem" href="../config/">Config</a></li><li><a class="tocitem" href="../disambiguation/">Disambiguation</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../devdocs/">Devdocs</a></li><li><a class="tocitem" href="../contacts/">Contacts</a></li></ul></li><li><span class="tocitem">Customizations</span><ul><li><a class="tocitem" href="../customizations/customizations/">Overview</a></li><li><a class="tocitem" href="../customizations/orders/">Orders</a></li><li><a class="tocitem" href="../customizations/backtest/">Backtester</a></li><li><a class="tocitem" href="../customizations/exchanges/">Exchanges</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../API/collections/">Collections</a></li><li><a class="tocitem" href="../API/data/">Data</a></li><li><a class="tocitem" href="../API/executors/">Engine</a></li><li><a class="tocitem" href="../API/instances/">Instances</a></li><li><a class="tocitem" href="../API/instruments/">Instruments</a></li><li><a class="tocitem" href="../API/misc/">Misc</a></li><li><a class="tocitem" href="../API/optimization/">Optimization</a></li><li><a class="tocitem" href="../API/pbar/">Pbar</a></li><li><a class="tocitem" href="../API/plotting/">Plotting</a></li><li><a class="tocitem" href="../API/prices/">Prices</a></li><li><a class="tocitem" href="../API/processing/">Processing</a></li><li><a class="tocitem" href="../API/stats/">Stats</a></li><li><a class="tocitem" href="../API/strategies/">Strategies</a></li><li><input class="collapse-toggle" id="menuitem-13-14" type="checkbox"/><label class="tocitem" for="menuitem-13-14"><span class="docs-label">Analysis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../API/analysis/analysis/">Analysis</a></li><li><a class="tocitem" href="../API/analysis/mlong/">MLong</a></li><li><a class="tocitem" href="../API/analysis/mshort/">MShort</a></li><li><a class="tocitem" href="../API/analysis/mvp/">MVP</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Optimization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Optimization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/panifie/PingPong.jl/blob/master/docs/src/optimization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Optimization"><a class="docs-heading-anchor" href="#Optimization">Optimization</a><a id="Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization" title="Permalink"></a></h1><p>PingPong provides tools to optimize strategy parameters. Optimzations are managed through the <code>OptSession</code> type. Which is a structure that holds informations about the optimization parameters, configuration and previous runs. Optimization sessions can be periodically saved, and therefore can be reloaded at a later time to explore previous results or continue the optimization from where it left off.</p><p>There are currently 3 different optimization methods: <code>gridsearch</code>, <code>bboptimize</code> <code>boptimize!</code>. Configuration is done by defining three <code>ping!</code> functions.</p><ul><li><code>ping!(::S, ::OptSetup)</code>: returns a named tuples with:<ul><li><code>ctx</code>: a <code>Executors.Context</code> which is the period of time used for backtesting</li><li><code>params</code>: a named tuple of all the parameters to be optimizied. Values should be in the form of iterables.</li><li><code>space</code>: only required for <code>bboptimize</code>, a named tuple where<ul><li><code>kind</code>: is the type of space (from <code>BlackBoxOptim</code> package)</li><li><code>precision</code>: If the space is <code>:MixedPrecisionRectSearchSpace</code> it is a vector where each element is the number of decimals to consider in parameters of type float.</li></ul></li></ul></li><li><code>ping!(::S, ::OptRun)</code>: called before a single backtest is run. Receives one combination of the parameters. Should apply the parameters to the strategy. No return values expected.</li><li><code>ping!(::S, ::OptScore)::Vector</code>: for <code>bboptimize</code> and <code>boptimize!</code> it is the objective score that advances the optimization. In grid search it can be used to store additional metrics in the results dataframe. Within the <code>Stats</code> package there are metrics like <code>sharpe</code><code>or</code>sortino` commonly used as optimization objectives.</li></ul><h3 id="Grid-search"><a class="docs-heading-anchor" href="#Grid-search">Grid search</a><a id="Grid-search-1"></a><a class="docs-heading-anchor-permalink" href="#Grid-search" title="Permalink"></a></h3><p>This is the recommended approach, useful if the strategy has a small set of parameters (&lt;5).</p><pre><code class="language-julia hljs">using Optimization
gridsearch(s, repeats=1, save_freq=Minute(1), resume=false)</code></pre><p>Will perform an search from scratch, saving every minute. <code>repeats</code> controls the number of times a backtest is run using the <em>same</em> combination of parameters. When repeats &gt; 1 we split the optimization <code>Context</code> into shorter ranges and restart the backtest on each one of these sub contexes. This allows to fuzz out scenarios of overfitting by averaging the results of different backtest &quot;restarts&quot;.</p><h3 id="Black-box-optimization"><a class="docs-heading-anchor" href="#Black-box-optimization">Black box optimization</a><a id="Black-box-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Black-box-optimization" title="Permalink"></a></h3><p>The <code>BlackBoxOptim</code> offers multiple methods for searching, also also offers multi objective optimization. You can pass any arg supported by the upstream <code>bboptimze</code> function.</p><pre><code class="language-julia hljs">Optimization.bboptimize(s, repeats=3, MaxTime=240.0, Method=:borg_moea)</code></pre><p>We exclude some optimization methods because they are slow or for some other quirks. Get the list of methods by calling <code>bbomethods</code>.</p><pre><code class="language-julia hljs">Optimization.bbomethods()
Optimization.bbomethods(true) # multi obj methods</code></pre><p><code>@doc bboptimize</code> shows some common argument you might want to pass to the optimization function like <code>MaxTime</code> or <code>MaxSteps</code>. For the full list refer to the <code>BlackBoxOptimi</code> package.</p><p>The <code>BayesianOptimization</code> package instead focus on gausiann processes and is provided as an extension of the <code>Optimization</code> package, (you need to install the packgage yourself). If you want to customize the optimization parameters you can define methods for your strategy over the functions <code>gpmodel</code>, <code>modelopt</code> and <code>acquisition</code>. Like <code>bboptimize</code> you can pass any upstream kwargs to <code>boptimize!</code>.</p><h2 id="Multi-threading"><a class="docs-heading-anchor" href="#Multi-threading">Multi threading</a><a id="Multi-threading-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-threading" title="Permalink"></a></h2><p>Parallel execution is supported for the optimizations in different capacities. For grid search we allow parallel execution between different combinations, while repetitions are done sequentially. For black box optimization instead, repetitions are done in parallel, while the optimization run is done sequentially because the improvement of parallel execution during optimization is marginal, and because <code>BlackBoxOptim</code> current multi threading support is broken. Multi threading is only enabled if the strategy defines a global value like:</p><pre><code class="language-julia hljs">const THREADSAFE = Ref(true)</code></pre><div class="admonition is-warning"><header class="admonition-header">Thread safety</header><div class="admonition-body"><p>Multi threading is not safe in general, avoid any use of python objects within your strategy or you will incur into crashes. Use locks or <code>ConcurrentCollections</code> for synchronization. You are responsible for the thread safety of your strategy.</p></div></div><h2 id="Plotting-results"><a class="docs-heading-anchor" href="#Plotting-results">Plotting results</a><a id="Plotting-results-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-results" title="Permalink"></a></h2><p>After completing an optimization, the results can be plotted using the function <code>Plotting.plot_results</code>. The function accepts many arguments in order to customize which axes to plot (up to 3), how to customize coloring of plot elements (e.g. default cash column in a scatter plot go from red to green) and how to group results elements. It by default plot a scatter. Surfaces and contourf also work fine.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../stats/">« Stats</a><a class="docs-footer-nextpage" href="../plotting/">Plotting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 7 July 2023 09:29">Friday 7 July 2023</span>. Using Julia version 1.10.0-alpha1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
